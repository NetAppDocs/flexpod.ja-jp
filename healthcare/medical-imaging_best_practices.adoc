---
sidebar: sidebar 
permalink: healthcare/medical-imaging_best_practices.html 
keywords: secure, multitenancy, availability, storage, best, practices, san, boot, efficiency, thin, provisioning,, service, quality, medical, imaging 
summary: このセクションでは、 NetApp FlexPod Express ストレージクラスタ設計のベストプラクティスについて説明します。 
---
= ベストプラクティス
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/




== ストレージのベストプラクティス



=== 高可用性

ネットアップストレージクラスタはあらゆるレベルで高可用性を提供します。

* クラスタノード
* バックエンドストレージの接続
* 3 つのディスク障害に対応できる RAID-TEC
* 2 つのディスクに障害が発生しても運用を継続できる RAID DP
* 各ノードから 2 つの物理ネットワークへの物理接続
* ストレージ LUN およびボリュームへの複数のデータパス




=== セキュアマルチテナンシー

ネットアップの Storage Virtual Machine （ SVM ）は、セキュリティドメイン、ポリシー、および仮想ネットワークを分離するための仮想ストレージアレイ構造を提供します。ストレージクラスタのデータをホストするテナント組織ごとに専用の SVM を作成することを推奨します。



=== ネットアップストレージのベストプラクティス

次のネットアップストレージのベストプラクティスを考慮してください。

* サポート概要情報を HTTPS 経由でネットアップに送信する NetApp AutoSupport テクノロジは常に有効にしてください。
* 可用性と移動性を最大限に高めるために、 NetApp ONTAP クラスタ内の各ノードに各 SVM 用に LIF が作成されていることを確認してください。Asymmetric Logical Unit Access （ ALUA ；非対称論理ユニットアクセス）は、パスを解析し、アクティブな最適化（直接）パスとアクティブな非最適化パスを識別するために使用されます。ALUA は、 FC 、 FCoE 、 iSCSI の両方に使用されます。
* LUN のみが含まれるボリュームは内部でマウントする必要がなく、ジャンクションパスも必要ありません。
* ESXi でチャレンジハンドシェイク認証プロトコル（ CHAP ）をターゲット認証に使用する場合は、 ONTAP でも設定する必要があります。CLI （「 vserver iscsi security create 」）または NetApp ONTAP System Manager （ストレージ > SVM > SVM 設定 > プロトコル > iSCSI でイニシエータセキュリティを編集）を使用します。




=== SAN ブート

Cisco UCS サーバの SAN ブートは、 FlexPod Datacenter 解決策に実装することを推奨します。この手順により、オペレーティングシステムを NetApp AFF ストレージシステムによって安全に保護し、パフォーマンスを向上させることができます。この解決策で概説している設計では、 iSCSI SAN ブートを使用します。

iSCSI SAN ブートでは、各 Cisco UCS サーバに 2 つの iSCSI vNIC （各 SAN ファブリックに 1 つずつ）が割り当てられ、ストレージへのすべての方法で冗長接続が提供されます。この例では、 Cisco Nexus スイッチに接続された e2a と e2a のストレージポートを、インターフェイスグループ（ ifgrp ）と呼ばれる 1 つの論理ポートにグループ化しています（この例では a0a ）。iSCSI VLAN は igroup 上に作成され、 iSCSI ポートグループ（この例では、 a0a -<iscsi-A-vlan> ）上に iSCSI LIF が作成されます。iSCSI ブート LUN は、 igroup を使用して iSCSI LIF を通じてサーバに公開されます。この方法では、許可されたサーバのみがブート LUN にアクセスできます。ポートと LIF のレイアウトについては、次の図を参照してください。

image:medical-imaging_image8.png["エラー：グラフィックイメージがありません"]

NAS ネットワークインターフェイスとは異なり、 SAN ネットワークインターフェイスは障害発生時にフェイルオーバーするように設定されません。代わりに、ネットワークインターフェイスが使用できなくなった場合は、ホストによって、使用可能なネットワークインターフェイスへの最適パスが新たに選択されます。ネットアップがサポートする標準の ALUA は、 SCSI ターゲットに関する情報を提供します。これにより、ホストはストレージへの最適なパスを識別できます。



=== ストレージ効率とシンプロビジョニング

ネットアップは、プライマリワークロードに対して初めて重複排除を実行する場合や、圧縮機能を強化して小さなファイルと I/O を効率的に格納するインラインデータコンパクションを使用する場合など、 Storage Efficiency の革新的なテクノロジで業界をリードしてきました。ONTAP は、インライン重複排除とバックグラウンド重複排除のほか、インライン圧縮とバックグラウンド圧縮の両方をサポートしています。

ブロック環境で重複排除のメリットを実現するには、 LUN をシンプロビジョニングする必要があります。VM 管理者からは引き続き LUN がプロビジョニング済み容量として認識されますが、重複排除による削減効果は他のニーズに使用できるようにボリュームに戻されます。これらの LUN は、 LUN の 2 倍の容量でシンプロビジョニングされた FlexVol に導入することを推奨します。この方法で LUN を導入した場合、 FlexVol ボリュームは単なるクォータとして機能し、LUN が消費するストレージは、 FlexVol とその包含アグリゲートでレポートされます。

重複排除による削減効果を最大限に高めるために、バックグラウンド重複排除のスケジュール設定を検討しただし、これらのプロセスは、実行時にシステムリソースを使用します。そのため、あまりアクティブでない時間帯（週末など）にスケジュールを設定するか、頻繁に実行して、処理される変更データの量を減らすことを推奨します。AFF システムでの自動バックグラウンド重複排除は、フォアグラウンドアクティビティに対する影響を大幅に軽減します。バックグラウンド圧縮（ハードディスクベースのシステムの場合）でもリソースが消費されるため、パフォーマンス要件が限定されたセカンダリワークロードでのみ使用することを検討してください。



=== サービス品質

ONTAP ソフトウェアを実行するシステムでは、 ONTAP ストレージ QoS 機能を使用して、スループットをメガビット / 秒（ Mbps ）で制限できます。また、ファイル、 LUN 、ボリューム、 SVM 全体などのさまざまなストレージオブジェクトの IOPS を制限できます。アダプティブ QoS を使用して、 IOPS の下限（ QoS 最小）と上限（ QoS 最大）を設定します。これは、データストアの容量と使用済みスペースに基づいて動的に調整されます。

スループットの制限は、不明なワークロードや、導入前のテストワークロードを制御して、他のワークロードに影響しないことを確認するのに役立ちます。また、これらの制限を使用して、特定された Bully ワークロードを制限することもできます。IOPS に基づく最小サービスレベルもサポートされており、 ONTAP の SAN オブジェクトに一貫したパフォーマンスを提供できます。

NFS データストアでは、 QoS ポリシーを FlexVol ボリューム全体またはボリューム内の個々の仮想マシンディスク（ VMDK ）ファイルに適用できます。ONTAP LUN を使用する VMFS データストア（ Hyper-V の Cluster Shared Volume （ CSV ；クラスタ共有ボリューム）では、 LUN を含む FlexVol または個々の LUN に QoS ポリシーを適用できます。ただし、 ONTAP は VMFS を認識しないため、個々の VMDK ファイルに QoS ポリシーを適用できません。VSC 7.1 以降で VMware 仮想ボリューム（ vVol ）を使用する場合、ストレージ機能プロファイルを使用して個々の VM に最大 QoS を設定できます。

VMFS または CSV を含む LUN に QoS ポリシーを割り当てるには、 VSC ホームページのストレージシステムメニューから ONTAP SVM （「 Vserver 」と表示）、 LUN パス、およびシリアル番号を取得します。ストレージシステム（ SVM ）を選択し、 Related Objects > SAN を選択します。この方法は、いずれかの ONTAP ツールを使用して QoS を指定する場合に使用します。

オブジェクトの QoS の最大スループット制限を MBps と IOPS で設定できます。両方を使用する場合は、最初に到達した制限が ONTAP によって適用されます。ワークロードには複数のオブジェクトを含めることができ、 QoS ポリシーは 1 つ以上のワークロードに適用できます。ポリシーを複数のワークロードに適用すると、ポリシーの制限はワークロード全体に適用されます。ネストされたオブジェクトはサポートされません（たとえば、ボリューム内のファイルについては、各ファイルに独自のポリシーを設定することはできません）。QoS の最小値は IOPS 単位でのみ設定できます。



=== ストレージレイアウト

ここでは、ストレージ上の LUN 、ボリューム、およびアグリゲートのレイアウトに関するベストプラクティスを示します。



==== Storage LUNs

最適なパフォーマンス、管理、バックアップを実現するために、 LUN 設計に関する次のベストプラクティスを推奨します。

* データベースデータとログファイルを格納するための独立した LUN を作成します。
* Oracle データベースログバックアップを格納するために、インスタンスごとに個別の LUN を作成します。LUN は同じボリュームに属することができます。
* データベースファイルとログファイル用にシンプロビジョニングを使用して LUN をプロビジョニング（スペースリザベーションオプションを無効に）します。
* すべてのイメージングデータは FC LUN でホストされます。FlexVol ボリューム内にこれらの LUN を作成します。これらの LUN は、異なるストレージコントローラノードに所有されているアグリゲート間に分散されています。


ストレージボリューム内での LUN の配置については、次のセクションのガイドラインに従ってください。



==== ストレージボリューム

最適なパフォーマンスと管理を実現するために、ボリューム設計に関する次のベストプラクティスを推奨します。

* I/O負荷の高いクエリを使用して、別々のストレージボリュームにデータベースを分離します。
* データファイルは1つのLUNまたはボリュームに配置できますが、スループットを高めるためには複数のボリューム/ LUNを使用することを推奨します。
* 複数のLUNを使用する場合は、サポートされている任意のファイルシステムを使用してI/Oの並列処理を実現できます。
* データベースファイルとトランザクションログは別々のボリュームに配置すると、リカバリの精度が向上します。
* 自動サイズ、Snapshotリザーブ、QoSなどのボリューム属性の使用を検討してください。




==== アグリゲート

アグリゲートは、ネットアップストレージ構成のプライマリストレージコンテナであり、データディスクとパリティディスクの両方で構成される 1 つ以上の RAID グループを含みます。

ネットアップでは、データファイルとトランザクションログファイルが分離された共有アグリゲートと専用アグリゲートを使用して、さまざまな I/O ワークロード特性分析テストを実施しました。このテストでは、複数の RAID グループとドライブ（ HDD または SSD ）を使用する 1 つの大規模なアグリゲートによって、ストレージパフォーマンスが最適化されて向上するとともに、管理者が次の 2 つの理由から管理しやすくなることが実証されています。

* 1 つの大きなアグリゲートで、すべてのドライブの I/O 機能をすべてのファイルで使用できます。
* 1 つの大きなアグリゲートで、最も効率的なディスクスペースを使用できます。


効果的なディザスタリカバリを実現するために、ディザスタリカバリサイトの別のストレージクラスタの一部であるアグリゲートに非同期レプリカを配置し、 SnapMirror テクノロジを使用してコンテンツをレプリケートすることを推奨します。

ストレージのパフォーマンスを最適化するために、アグリゲートには少なくとも 10% の空きスペースを確保することを推奨します。

AFF A300 システム（ 24 ドライブ搭載の 2 台のディスクシェルフ）のストレージアグリゲートのレイアウトガイダンスには、次のものがあります。

* スペアドライブを 2 本用意します。
* アドバンストディスクパーティショニングを使用して、各ドライブにルートとデータの 3 つのパーティションを作成します。
* アグリゲートごとに合計 20 個のデータパーティションと 2 個のパリティパーティションを使用します。




== バックアップのベストプラクティス

NetApp SnapCenter は、 VM とデータベースのバックアップに使用されます。バックアップに関する次のベストプラクティスを推奨します。

* バックアップ用の Snapshot コピーを作成するために SnapCenter を導入している場合は、 VM とアプリケーションデータをホストする FlexVol の Snapshot スケジュールを無効にします。
* ホストブート LUN 専用の FlexVol を作成します。
* 同じ目的に使用する VM に、同様のバックアップポリシーまたは単一のバックアップポリシーを使用します。
* ワークロードタイプに応じて同様のバックアップポリシーまたは単一のバックアップポリシーを使用します。たとえば、すべてのデータベースワークロードに同様のポリシーを使用します。データベース、 Web サーバ、エンドユーザ仮想デスクトップなどに異なるポリシーを使用します。
* SnapCenter でバックアップの検証を有効にします。
* バックアップ Snapshot コピーのアーカイブを NetApp SnapVault バックアップ解決策に設定します。
* アーカイブスケジュールに基づいて、プライマリストレージでのバックアップの保持を設定します。




== インフラのベストプラクティス



=== ネットワークのベストプラクティス

ネットアップでは、ネットワークに関する次のベストプラクティスを推奨しています。

* システムに、本番トラフィックとストレージトラフィック用に冗長な物理 NIC が搭載されていることを確認します。
* コンピューティングとストレージの間で iSCSI 、 NFS 、 SMB / CIFS のトラフィック用に VLAN を分離
* システムに、医療画像システムへのクライアントアクセス専用の VLAN が含まれていることを確認してください。


ネットワークに関するその他のベストプラクティスについては、 FlexPod インフラの設計および導入ガイドを参照してください。



== コンピューティングのベストプラクティス

推奨されるコンピューティングのベストプラクティスは次のとおりです。

* 指定した各 vCPU が物理コアでサポートされていることを確認してください。




== 仮想化のベストプラクティス

仮想化に関する次のベストプラクティスを推奨します。

* VMware vSphere 6 以降を使用。
* ESXi ホストサーバの BIOS と OS レイヤを Custom Controlled – High Performance に設定します。
* バックアップはピーク時以外の時間帯に作成してください。




== 医療画像システムのベストプラクティス

一般的な医用画像システムの次のベストプラクティスといくつかの要件を参照してください。

* 仮想メモリをオーバーコミットしないでください。
* vCPU の総数が物理 CPU の数と同じであることを確認してください。
* 大規模な環境では、専用の VLAN が必要です。
* 専用の HA クラスタを使用してデータベース VM を設定する。
* VM OS の VMDK が高速階層 1 のストレージでホストされていることを確認します。
* 医療画像システムベンダーと協力して、迅速な導入とメンテナンスのために VM テンプレートを準備する最適な方法を特定します。
* 管理、ストレージ、本番環境のネットワークでは、 VMware vMotion 用に独立した VLAN を使用して、データベースを LAN で分離する必要があります。
* と呼ばれるネットアップのストレージアレイベースのレプリケーションテクノロジを使用します https://www.netapp.com/us/media/tr-4015.pdf["SnapMirror"^] vSphereベースのレプリケーションではなく、
* VMware API を活用したバックアップテクノロジを使用します。バックアップウィンドウは通常の業務時間外にする必要があります。

